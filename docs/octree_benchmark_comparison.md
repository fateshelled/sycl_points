# Octree KNN ベンチマーク比較

Octree の近傍候補管理を最大ヒープ方式で実装した最新版と KDTree を比較した結果です。ベンチマークテスト `OctreeTest.BenchmarkOctreeAgainstKDTree` をウォームアップ後に 100 回平均で計測し、点群構成はテストコードのデフォルト設定に従っています。

### 構築時間 (ms)

| ケース | ターゲット点数 | クエリ点数 | k | Octree (最大ヒープ) | KDTree |
| --- | --- | --- | --- | --- | --- |
| 1 | 10,000 | 1,000 | 1 | 2.440 | 4.669 |
| 1 | 10,000 | 1,000 | 10 | 2.414 | 4.448 |
| 1 | 10,000 | 1,000 | 20 | 2.055 | 4.484 |
| 1 | 10,000 | 1,000 | 30 | 2.967 | 4.423 |
| 2 | 50,000 | 5,000 | 1 | 9.514 | 24.766 |
| 2 | 50,000 | 5,000 | 10 | 9.961 | 25.499 |
| 2 | 50,000 | 5,000 | 20 | 12.191 | 25.427 |
| 2 | 50,000 | 5,000 | 30 | 10.365 | 26.745 |
| 3 | 100,000 | 10,000 | 1 | 20.712 | 50.529 |
| 3 | 100,000 | 10,000 | 10 | 18.839 | 51.019 |
| 3 | 100,000 | 10,000 | 20 | 21.947 | 50.871 |
| 3 | 100,000 | 10,000 | 30 | 22.369 | 52.108 |

### 探索時間 (ms)

| ケース | ターゲット点数 | クエリ点数 | k | Octree (最大ヒープ) | KDTree |
| --- | --- | --- | --- | --- | --- |
| 1 | 10,000 | 1,000 | 1 | 2.010 | 1.174 |
| 1 | 10,000 | 1,000 | 10 | 4.914 | 2.597 |
| 1 | 10,000 | 1,000 | 20 | 7.208 | 3.874 |
| 1 | 10,000 | 1,000 | 30 | 8.291 | 5.581 |
| 2 | 50,000 | 5,000 | 1 | 9.142 | 4.794 |
| 2 | 50,000 | 5,000 | 10 | 20.474 | 11.948 |
| 2 | 50,000 | 5,000 | 20 | 33.028 | 17.762 |
| 2 | 50,000 | 5,000 | 30 | 40.820 | 23.132 |
| 3 | 100,000 | 10,000 | 1 | 23.106 | 9.633 |
| 3 | 100,000 | 10,000 | 10 | 46.068 | 21.563 |
| 3 | 100,000 | 10,000 | 20 | 68.824 | 32.977 |
| 3 | 100,000 | 10,000 | 30 | 95.542 | 44.025 |

### データセットベンチマーク (PLY)

ベンチマークテスト `OctreeTest.BenchmarkOctreeWithDatasetTargets` を用いて、`data/target.ply` をターゲット、`data/source.ply` をクエリとして 50 回平均で計測しました。Octree は i-octree 方式導入前のコミット `4052d42` と導入後 (現在の HEAD) で比較し、KDTree は参考値として現行実装の結果を示します。

| k | Octree 構築 前 (ms) | Octree 構築 後 (ms) | Octree 探索 前 (ms) | Octree 探索 後 (ms) | KDTree 構築 (ms) | KDTree 探索 (ms) |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 21.39 | 26.87 | 843.43 | 171.35 | 37.96 | 68.54 |
| 10 | 21.43 | 26.33 | 1044.06 | 220.80 | 38.37 | 153.16 |
| 20 | 25.82 | 26.59 | 1215.69 | 302.62 | 40.38 | 249.78 |
| 30 | 22.06 | 24.07 | 1413.44 | 374.94 | 41.38 | 311.52 |

Octree の構築時間はわずかに増加したものの、探索時間は大幅に短縮され、特に k=1 で約 5 倍高速になりました。
