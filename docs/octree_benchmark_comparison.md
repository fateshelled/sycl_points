# Octree KNN ベンチマーク比較

以下の結果は、Octree の近傍候補管理方式を

1. **最大ヒープ方式（旧実装）**
2. **昇順配列挿入方式（Turn 11 の実装）**
3. **最大ヒープ方式をベースにヒープソートで結果を整列する最新実装**

で比較したものです。ベンチマークテスト `OctreeTest.BenchmarkOctreeAgainstKDTree` をウォームアップののち100回平均で計測し、点群構成は commit `b734b61` 時点のテスト実装に従います。

### 構築時間 (ms)

| ケース | ターゲット点数 | クエリ点数 | k | 最大ヒープ | 昇順配列挿入 | 最新ヒープ |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 10,000 | 1,000 | 1 | 1.885 | 2.349 | 2.408 |
| 1 | 10,000 | 1,000 | 10 | 1.633 | 2.067 | 3.293 |
| 1 | 10,000 | 1,000 | 20 | 1.606 | 2.425 | 2.463 |
| 1 | 10,000 | 1,000 | 30 | 2.047 | 3.675 | 2.178 |
| 2 | 50,000 | 5,000 | 1 | 8.099 | 12.046 | 11.726 |
| 2 | 50,000 | 5,000 | 10 | 8.029 | 11.799 | 11.752 |
| 2 | 50,000 | 5,000 | 20 | 8.419 | 11.079 | 10.554 |
| 2 | 50,000 | 5,000 | 30 | 8.060 | 10.938 | 11.544 |
| 3 | 100,000 | 10,000 | 1 | 15.114 | 17.812 | 22.340 |
| 3 | 100,000 | 10,000 | 10 | 17.462 | 20.074 | 19.932 |
| 3 | 100,000 | 10,000 | 20 | 14.828 | 25.088 | 21.474 |
| 3 | 100,000 | 10,000 | 30 | 15.201 | 20.258 | 21.506 |

### 探索時間 (ms)

| ケース | ターゲット点数 | クエリ点数 | k | 最大ヒープ | 昇順配列挿入 | 最新ヒープ |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 10,000 | 1,000 | 1 | 1.488 | 2.234 | 2.589 |
| 1 | 10,000 | 1,000 | 10 | 4.181 | 5.908 | 4.738 |
| 1 | 10,000 | 1,000 | 20 | 6.365 | 8.152 | 8.363 |
| 1 | 10,000 | 1,000 | 30 | 8.595 | 10.273 | 10.940 |
| 2 | 50,000 | 5,000 | 1 | 10.336 | 11.153 | 11.034 |
| 2 | 50,000 | 5,000 | 10 | 21.279 | 26.740 | 27.558 |
| 2 | 50,000 | 5,000 | 20 | 29.334 | 43.757 | 40.278 |
| 2 | 50,000 | 5,000 | 30 | 39.855 | 57.541 | 57.700 |
| 3 | 100,000 | 10,000 | 1 | 20.764 | 30.347 | 28.293 |
| 3 | 100,000 | 10,000 | 10 | 44.474 | 59.902 | 61.242 |
| 3 | 100,000 | 10,000 | 20 | 67.756 | 96.612 | 89.848 |
| 3 | 100,000 | 10,000 | 30 | 85.769 | 117.375 | 117.153 |

- 「昇順配列挿入」は Turn 11 で導入した挿入ソート方式の結果です。
- 「最新ヒープ」は今回の修正で導入した最大ヒープ + ヒープソート方式の結果です。
- 依然として最新実装は旧ヒープ方式より遅いケースがあるため、さらなる最適化余地が残っています。
